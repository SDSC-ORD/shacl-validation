name: 'SHACL validation'
description: 'This action will validate RDF graphs in `.ttl` format using the [TopQuadrant SHACL API](https://github.com/TopQuadrant/shacl), which passed [100% of the tests](https://w3c.github.io/data-shapes/data-shapes-test-suite/#validate-rdf-data-tests) related to RDF validation.'
inputs:
  validation-data: 
    description: 'RDF data in .ttl format to validate'
    required: true
  validation-rules:
    description: 'RDF data in .ttl format containing the constraints/SHACL rules'
    required: false
    default: 'None'
  github_token:
    description: 'GITHUB_TOKEN'
    required: true
    default: '${{ github.token }}'
outputs:
  validation-status:
    description: 'Validation status: failed or passed'
  validation-report:
    description: 'Detailed report in .ttl format with the validation results'
runs:
  using: 'composite'
  steps:
    - name: Login to GitHub Container Registry
      uses: docker/login-action@v2
      with:
        registry: ghcr.io
        username: ${{ github.actor }}
        password: ${{ inputs.github_token }}
    - if: ${{ inputs.validation-rules == 'None' }}
      shell: bash
      run: |
        echo "validation_report=$(docker run -v /var/run/docker.sock:/var/run/docker.sock ghcr.io/sdsc-ord/shacl:latest validate -datafile ${{ inputs.validation-data }} -shapesfile ${{ inputs.validation-rules }})" >> "$GITHUB_OUTPUT"
    - if: ${{ inputs.validation-rules != 'None' }}
      shell: bash
      run: |
        echo "validation_report=$(docker run -v /var/run/docker.sock:/var/run/docker.sock -v ${{ inputs.validation-data }}:${{ inputs.validation-data }} -v ${{ inputs.validation-rules }}:${{ inputs.validation-rules }} ghcr.io/sdsc-ord/shacl:latest validate -datafile ${{ inputs.validation-data }} -shapesfile ${{ inputs.validation-rules }})" >> "$GITHUB_OUTPUT"